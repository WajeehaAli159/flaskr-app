{% extends 'base.html' %}
{% block content %}

  <!-- Hero -->
  <section class="hero rounded-4 p-4 p-md-5 mb-4">
    <h1 class="display-6 fw-semibold mb-2">Latest Posts</h1>
    <p class="mb-0 text-hero">Your clean, minimal blog — simple to write, beautiful to read.</p>
  </section>

  {% if posts %}
    <div class="row g-3">
      {% for post in posts %}
        <div class="col-12">
          <article class="card post-card p-3 p-md-4">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
              <h2 class="h4 m-0">
                <a class="text-decoration-none post-title" href="{{ url_for('blog.update', id=post['id']) }}">
                  {{ post['title'] }}
                </a>
              </h2>
              <small class="text-secondary">
                by {{ post['username'] }} • {{ post['created'].strftime('%b %d, %Y') }}
              </small>
            </div>
            <hr class="border-secondary opacity-25">
            <p class="mb-3">{{ (post['body'] or '')[:260] }}{% if (post['body'] or '')|length > 260 %}…{% endif %}</p>

            {% if g.user and g.user['id'] == post['author_id'] %}
              <div class="d-flex gap-2">
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('blog.update', id=post['id']) }}">
                  <i class="bi bi-pencil-square me-1"></i>Edit
                </a>
                <form action="{{ url_for('blog.delete', id=post['id']) }}" method="post" onsubmit="return confirm('Delete this post?');">
                  <button class="btn btn-outline-danger btn-sm" type="submit">
                    <i class="bi bi-trash me-1"></i>Delete
                  </button>
                </form>
              </div>
            {% endif %}
          </article>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty">
      <i class="bi bi-inbox"></i>
      <p>No posts yet.{% if g.user %} Create your first one!{% endif %}</p>
    </div>
  {% endif %}
{% endblock %}
